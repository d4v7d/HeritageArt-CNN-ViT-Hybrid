version: '3.9'
services:
  poc:
    build:
      context: ./docker
      dockerfile: Dockerfile
  image: poc-art-damage:cuda126
    container_name: poc-art-damage
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]
    volumes:
      - ./src:/workspace/src:ro
      - ./configs:/workspace/configs:ro
      - ./samples:/workspace/samples:ro
      - ./logs:/workspace/logs
    working_dir: /workspace
    stdin_open: true
    tty: true
    command: bash -lc "python -m src.run_all --image samples/demo.jpg"
