# POC-4: Optimized Training Configuration
# Binary segmentation: Damage (1) vs Clean (0)
# Goal: Maximize mIoU with best hyperparameters

model:
  name: "resnet50_unet"
  encoder: "resnet50"
  encoder_weights: "imagenet"
  in_channels: 3
  classes: 2  # Binary: damage vs clean

data:
  root: "data/artefact"
  image_size: 512  # Resize all images to this size
  tile_size: 512
  train_val_split: 0.8
  ignore_index: 255
  
  # Class mapping: 0=Clean, 1-15=Damage, 255=Ignore
  binary_mode: true  # Collapse all damage classes to 1

training:
  batch_size: 4
  epochs: 60  # Extended to 60 epochs
  learning_rate: 0.0003  # Balanced LR (between 0.0001 and 0.0005)
  weight_decay: 0.00005  # Reduced weight decay for small dataset
  
  # Loss function - optimized weights
  loss:
    type: "dice_focal"
    dice_weight: 0.7  # More emphasis on Dice (better for IoU)
    focal_weight: 0.3
    focal_alpha: 0.25
    focal_gamma: 2.0
  
  # Optimizer
  optimizer: "adamw"
  
  # Scheduler - longer warmup and gentler decay
  scheduler:
    type: "cosine"
    warmup_epochs: 8  # Longer warmup for stability
    min_lr: 0.0000005  # Slightly higher min LR
  
  # Checkpointing
  save_freq: 10  # Save every 10 epochs
  best_metric: "val_miou"  # Metric to track for best model

augmentation:
  train:
    # Moderate augmentations to reduce overfitting
    horizontal_flip: 0.5
    vertical_flip: 0.5
    rotate_limit: 20  # Reduced rotation (was 30)
    brightness_limit: 0.25  # Moderate brightness
    contrast_limit: 0.25  # Moderate contrast
    blur_limit: 4  # Moderate blur (was 5)
  
  val:
    # No augmentation for validation
    pass

evaluation:
  metrics:
    - "miou"
    - "f1"
    - "precision"
    - "recall"
    - "accuracy"
  
  visualize: true
  max_visualizations: 10

paths:
  checkpoints: "logs/checkpoints"
  logs: "logs/training"
  visualizations: "logs/visualizations"
  metrics: "logs/metrics"

seed: 42
device: "cuda"
num_workers: 4
