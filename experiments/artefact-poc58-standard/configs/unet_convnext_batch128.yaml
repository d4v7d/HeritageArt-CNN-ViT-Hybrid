# POC-5.8: U-Net + ConvNeXt-Tiny + AMP
# Standard configuration using SMP

model:
  architecture: DeepLabV3Plus    # ðŸ”¥ Changed from Unet (more memory efficient)
  encoder_name: resnet50          # ResNet50 (supports dilated convolutions)
  encoder_weights: imagenet       # Pretrained
  in_channels: 3
  classes: 16                     # Fine-grained classes
  activation: null                # No activation (logits)

data:
  data_dir: ../data/artefact
  image_size: 384
  num_workers: 16                # ðŸ”¥ Increased from 8 (more CPU workers)
  use_augmented: true            # ðŸ”¥ Use offline augmented dataset (3x multiplier)
  use_preload: true              # ðŸ”¥ RAM PRE-LOADING - eliminates I/O bottleneck
  preload_to_gpu: false          # Keep in RAM, not GPU (saves VRAM for batch size)

training:
  batch_size: 64                # DeepLabV3+: 1170/64 = 18 batches
  epochs: 50
  learning_rate: 0.001            # OneCycleLR will modulate
  weight_decay: 0.01
  mixed_precision: true           # ðŸ”¥ AMP enabled
  gradient_clip: 1.0

loss:
  type: dice                      # SMP DiceLoss
  mode: multiclass
  smooth: 1.0

optimizer:
  type: adamw
  betas: [0.9, 0.999]

scheduler:
  type: onecycle                  # Better than Cosine for small datasets
  max_lr: 0.001
  pct_start: 0.3                  # 30% warmup
  anneal_strategy: cos

dataloader:
  num_workers: 8
  pin_memory: true
  persistent_workers: true
  prefetch_factor: 4              # Prefetch more batches
  drop_last: true

augmentation:
  train:
    - Resize: [384, 384]
    - HorizontalFlip: {p: 0.5}
    - VerticalFlip: {p: 0.3}
    - RandomRotate90: {p: 0.3}
    - Normalize: {mean: [0.485, 0.456, 0.406], std: [0.229, 0.224, 0.225]}
  val:
    - Resize: [384, 384]
    - Normalize: {mean: [0.485, 0.456, 0.406], std: [0.229, 0.224, 0.225]}

logging:
  log_dir: logs
  save_best: true
  save_last: true

# Expected metrics with RAM PRE-LOADING:
# - Throughput: 60-80 imgs/s (3-4x improvement from 26 imgs/s baseline)
# - VRAM: 2-5% (still limited by small dataset/batch)
# - RAM: ~2-3GB for 1,463 images
# - Time/epoch: ~15s (vs ~45s CPU I/O baseline)
# - mIoU target: >22% (POC5.5 baseline)
